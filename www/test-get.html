<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GET Method Testing - WebServ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #e4e6ea;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            min-height: 100vh;
        }

        .container {
            display: flex;
            height: 100vh;
            padding: 0;
        }

        .left-panel {
            width: 50%;
            padding: 2rem;
            overflow-y: auto;
            border-right: 1px solid #2d3748;
        }

        .right-panel {
            width: 50%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #10b981;
        }

        .header h1 {
            font-size: 2rem;
            color: #f9fafb;
            margin-bottom: 0.5rem;
        }

        .nav-back {
            display: inline-block;
            margin-bottom: 1rem;
            color: #9ca3af;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .nav-back:hover {
            color: #10b981;
        }

        .section {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(55, 65, 81, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .section h2 {
            color: #f9fafb;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .test-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            font-size: 0.9rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            width: 100%;
            text-align: left;
        }

        .test-button:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .test-item {
            background: rgba(17, 24, 39, 0.6);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 8px;
            padding: 1rem;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .test-item:hover {
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
        }

        .test-item h3 {
            color: #10b981;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-item p {
            color: #9ca3af;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .warning {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            margin-bottom: 1rem;
            backdrop-filter: blur(5px);
        }

        .results-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .results-header h2 {
            color: #f9fafb;
            font-size: 1.3rem;
        }

        .clear-button {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
        }

        .result-area {
            background: rgba(17, 24, 39, 0.8);
            color: #f9fafb;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-y: auto;
            flex: 1;
            border: 1px solid rgba(75, 85, 99, 0.3);
            backdrop-filter: blur(5px);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }

            .left-panel, .right-panel {
                width: 100%;
                min-height: auto;
            }

            .left-panel {
                border-right: none;
                border-bottom: 1px solid #2d3748;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <a href="index.html" class="nav-back">‚Üê Back to Home</a>
            
            <div class="header">
                <h1>üì• GET Method Testing</h1>
                <p>Test directory listing, redirects, static files, and error handling</p>
            </div>

            <div class="warning">
                ‚ÑπÔ∏è <strong>GET Testing Guide:</strong> This interface tests common GET request scenarios including directory browsing, file serving, and error conditions.
            </div>

            <!-- Directory Listing Tests -->
            <div class="section">
                <h2>üìÅ Directory Listing</h2>
                <div class="test-grid">
                    <div class="test-item">
                        <h3>üìÇ Root Directory</h3>
                        <p>Test directory listing for the root path</p>
                        <button class="test-button" onclick="testGet('/')">üîç GET /</button>
                    </div>
                    <div class="test-item">
                        <h3>üìÇ WWW Directory</h3>
                        <p>Test directory listing for web content</p>
                        <button class="test-button" onclick="testGet('/www/')">üîç GET /www/</button>
                    </div>
                    <div class="test-item">
                        <h3>üìÇ Uploads Directory</h3>
                        <p>Test directory listing for uploads folder</p>
                        <button class="test-button" onclick="testGet('/uploads/')">üîç GET /uploads/</button>
                    </div>
                    <div class="test-item">
                        <h3>üìÇ CGI Directory</h3>
                        <p>Test directory listing for CGI scripts</p>
                        <button class="test-button" onclick="testGet('/cgi-bin/')">üîç GET /cgi-bin/</button>
                    </div>
                </div>
            </div>

            <!-- Static File Tests -->
            <div class="section">
                <h2>üìÑ Static Files</h2>
                <div class="test-grid">
                    <div class="test-item">
                        <h3>üè† Index Page</h3>
                        <p>Test serving the main index page</p>
                        <button class="test-button" onclick="testGet('/index.html')">üìÑ GET /index.html</button>
                    </div>
                    <div class="test-item">
                        <h3>üé® CSS File</h3>
                        <p>Test serving CSS stylesheets</p>
                        <button class="test-button" onclick="testGet('/style.css')">üé® GET /style.css</button>
                    </div>
                    <div class="test-item">
                        <h3>üñºÔ∏è Image File</h3>
                        <p>Test serving image files</p>
                        <button class="test-button" onclick="testGet('/favicon.ico')">üñºÔ∏è GET /favicon.ico</button>
                    </div>
                    <div class="test-item">
                        <h3>üìã Text File</h3>
                        <p>Test serving plain text files</p>
                        <button class="test-button" onclick="testGet('/README.md')">üìã GET /README.md</button>
                    </div>
                </div>
            </div>

            <!-- Redirect Tests -->
            <div class="section">
                <h2>üîÑ Redirects</h2>
                <div class="test-grid">
                    <div class="test-item">
                        <h3>‚Ü©Ô∏è Directory Without Slash</h3>
                        <p>Test redirect when accessing directory without trailing slash</p>
                        <button class="test-button" onclick="testGet('/www')">üîÑ GET /www</button>
                    </div>
                    <div class="test-item">
                        <h3>‚Ü©Ô∏è Uploads Without Slash</h3>
                        <p>Test redirect for uploads directory</p>
                        <button class="test-button" onclick="testGet('/uploads')">üîÑ GET /uploads</button>
                    </div>
                    <div class="test-item">
                        <h3>‚Ü©Ô∏è CGI Without Slash</h3>
                        <p>Test redirect for CGI directory</p>
                        <button class="test-button" onclick="testGet('/cgi-bin')">üîÑ GET /cgi-bin</button>
                    </div>
                </div>
            </div>

            <!-- Error Tests -->
            <div class="section">
                <h2>‚ùå Non-Existing Files</h2>
                <div class="test-grid">
                    <div class="test-item">
                        <h3>üö´ 404 Not Found</h3>
                        <p>Test 404 error for non-existing file</p>
                        <button class="test-button" onclick="testGet('/nonexistent.html')">‚ùå GET /nonexistent.html</button>
                    </div>
                    <div class="test-item">
                        <h3>üö´ 404 Directory</h3>
                        <p>Test 404 error for non-existing directory</p>
                        <button class="test-button" onclick="testGet('/notfound/')">‚ùå GET /notfound/</button>
                    </div>
                    <div class="test-item">
                        <h3>üö´ Invalid Path</h3>
                        <p>Test error handling for invalid paths</p>
                        <button class="test-button" onclick="testGet('/invalid/../path')">‚ùå GET /invalid/../path</button>
                    </div>
                    <div class="test-item">
                        <h3>üö´ Deep Path</h3>
                        <p>Test error for deeply nested non-existing path</p>
                        <button class="test-button" onclick="testGet('/deep/nested/path/file.txt')">‚ùå GET /deep/nested/path/file.txt</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="results-section">
                <div class="results-header">
                    <h2>üìä Test Results</h2>
                    <button class="clear-button" onclick="clearResults()">Clear Results</button>
                </div>
                <div id="results" class="result-area">Ready to test GET requests...
üöÄ Click any test button to see detailed results here.

üí° Test Categories:
  üìÅ Directory Listing - View folder contents
  üìÑ Static Files - Serve HTML, CSS, images
  üîÑ Redirects - Automatic URL redirection
  ‚ùå Error Handling - 404 and invalid paths

Select a test to begin!</div>
            </div>
        </div>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            const results = document.getElementById('results');
            results.textContent = 'Results cleared. Ready for new GET tests...\nüöÄ Select a test button to begin.';
        }

        async function testGet(path) {
            log(`üöÄ Testing GET request: ${path}`);
            
            try {
                const startTime = performance.now();
                const response = await fetch(path, {
                    method: 'GET',
                    headers: {
                        'Accept': '*/*',
                        'Cache-Control': 'no-cache'
                    }
                });
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                log(`üìä Response: ${response.status} ${response.statusText} (${duration}ms)`);
                log(`üîó Final URL: ${response.url}`);
                log(`üìã Response Headers:`);
                for (const [key, value] of response.headers.entries()) {
                    log(`  ${key}: ${value}`);
                }
                
                const responseText = await response.clone().text();
                const contentLength = responseText.length;
                log(`üìÑ Content Length: ${contentLength} bytes`);
                log(`üìÑ Content Preview: ${responseText.substring(0, 200)}${contentLength > 200 ? '...' : ''}`);
                
                // Show full response in new tab
                showResponseInNewTab('GET', path, response, responseText);
                
            } catch (error) {
                log(`üí• GET Error: ${error.message}`);
                showErrorAsHtml(`<h1>Network Error</h1><p>${error.message}</p>`);
            }
        }

        // Function to show server response in new tab
        function showResponseInNewTab(method, url, response, responseText) {
            const newTab = window.open('about:blank', '_blank');
            if (!newTab) {
                log('üö´ Popup blocked - unable to open response in new tab');
                return;
            }
            
            // If it's an error response (status >= 400), render it directly
            if (response.status >= 400) {
                newTab.document.write(responseText || '(empty response)');
                newTab.document.close();
                return;
            }

            const timestamp = new Date().toISOString();
            const headers = [];
            for (const [key, value] of response.headers.entries()) {
                headers.push(`${key}: ${value}`);
            }

            // Check if response is HTML content
            function isHtmlResponse(content) {
                if (!content || typeof content !== 'string') return false;
                const htmlIndicators = ['<!DOCTYPE', '<html', '<head>', '<body>', '<div', '<p>', '<h1', '<h2'];
                return htmlIndicators.some(indicator => 
                    content.toLowerCase().includes(indicator.toLowerCase())
                );
            }
            
            const html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${method} Response - ${response.status}</title>
                    <style>
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
                            margin: 0; 
                            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
                            color: #f9fafb;
                            min-height: 100vh;
                        }
                        .container {
                            max-width: 1200px;
                            margin: 0 auto;
                            padding: 2rem;
                        }
                        .header { 
                            background: rgba(31, 41, 55, 0.8);
                            backdrop-filter: blur(10px);
                            border: 1px solid rgba(55, 65, 81, 0.5);
                            border-radius: 12px;
                            padding: 2rem; 
                            margin-bottom: 2rem; 
                            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                        }
                        .status { 
                            font-size: 1.5em; 
                            margin-bottom: 1rem; 
                            color: #10b981;
                            font-weight: 600;
                        }
                        .section { 
                            background: rgba(31, 41, 55, 0.8);
                            backdrop-filter: blur(10px);
                            border: 1px solid rgba(55, 65, 81, 0.5);
                            border-radius: 12px;
                            padding: 1.5rem; 
                            margin-bottom: 1.5rem; 
                            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                            border-left: 4px solid #10b981;
                        }
                        .section h3 { 
                            margin-top: 0; 
                            color: #f9fafb; 
                            font-size: 1.2rem;
                            margin-bottom: 1rem;
                        }
                        .response-body { 
                            background: rgba(17, 24, 39, 0.8);
                            border: 1px solid rgba(75, 85, 99, 0.3);
                            border-radius: 8px;
                            padding: 1rem; 
                            white-space: pre-wrap; 
                            overflow-x: auto; 
                            font-family: 'Courier New', monospace;
                            color: #f9fafb;
                            backdrop-filter: blur(5px);
                            max-height: 500px;
                            overflow-y: auto;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: auto 1fr;
                            gap: 0.5rem 1rem;
                            font-family: 'Courier New', monospace;
                            font-size: 0.9rem;
                        }
                        .info-label {
                            font-weight: 600;
                            color: #9ca3af;
                        }
                        .info-value {
                            color: #f9fafb;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <div class="status">üì• GET Request Response</div>
                            <div class="info-grid">
                                <span class="info-label">Status:</span>
                                <span class="info-value">${response.status} ${response.statusText}</span>
                                <span class="info-label">URL:</span>
                                <span class="info-value">${response.url}</span>
                                <span class="info-label">Original URL:</span>
                                <span class="info-value">${url}</span>
                                <span class="info-label">Time:</span>
                                <span class="info-value">${timestamp}</span>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>üìÑ Response Content</h3>
                            <div class="response-body">${isHtmlResponse(responseText) 
                                ? responseText 
                                : (responseText || '(empty response)')}</div>
                        </div>
                        
                        <div class="section">
                            <h3>üìã Response Headers</h3>
                            <div class="response-body">${headers.length > 0 ? headers.join('\n') : 'No headers received'}</div>
                        </div>
                        
                        <div class="section">
                            <h3>üîç Request Details</h3>
                            <div class="info-grid">
                                <span class="info-label">Method:</span>
                                <span class="info-value">GET</span>
                                <span class="info-label">Requested URL:</span>
                                <span class="info-value">${url}</span>
                                <span class="info-label">Final URL:</span>
                                <span class="info-value">${response.url}</span>
                                <span class="info-label">Success:</span>
                                <span class="info-value">${response.ok ? 'Yes' : 'No'}</span>
                                <span class="info-label">Redirected:</span>
                                <span class="info-value">${response.redirected ? 'Yes' : 'No'}</span>
                                <span class="info-label">Content Size:</span>
                                <span class="info-value">${responseText ? responseText.length : 0} bytes</span>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            newTab.document.write(html);
            newTab.document.close();
        }

        // Function to show error as HTML content directly
        function showErrorAsHtml(responseText) {
            const newTab = window.open('about:blank', '_blank');
            if (!newTab) {
                log('üö´ Popup blocked - unable to open error response');
                return;
            }
            
            // Just write the raw HTML response from server, nothing else
            newTab.document.write(responseText);
            newTab.document.close();
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ GET Testing page loaded successfully!');
            log('üí° Ready to test GET requests for:');
            log('  üìÅ Directory Listing - /, /www/, /uploads/, /cgi-bin/');
            log('  üìÑ Static Files - HTML, CSS, images, text files');
            log('  üîÑ Redirects - Directory access without trailing slash');
            log('  ‚ùå Error Handling - 404 and invalid paths');
            log('');
            log('üéØ Click any test button to begin...');
        });
    </script>
</body>
</html>
