
# ===================================
# Web Server Configuration File
# ===================================

# First server block - Main server
server
{
    # Server network configuration
    host = 0.0.0.0;                    # Listen on all interfaces
    port = 8080;                       # Main port
    server_name = mysite.com www.mysite; # Server names

    # Security and limits
    client_max_body_size = 5M;         # Maximum request body size (5 MB)

    # Error page configuration
    error_page 404 www/errp/404.html;         # Custom 404 error page
    error_page 500 /500.html;          # Custom 500 error page

    # Root route - serves main website
    route /
    {
        methods = GET POST;             # Allowed HTTP methods
        root = ./test;                   # Document root directory
        autoindex = off;         # Enable directory browsing
    }

    # Images route - for serving images
    route /images
    {
        methods = GET POST;             # Allow GET and POST
        root = ./www/images;            # Images directory
        autoindex = on;         # Allow browsing image directory
    }

    # Videos route - for serving video files
    route /videos
    {
        methods = GET;                  # Only GET method allowed
        root = ./www/videos;            # Videos directory
        autoindex = on;         # Allow browsing video directory
    }

    # CGI route (commented out for now)
    # route /cgi-bin
    # {
    #     methods = GET POST DELETE;
    #     redirect = http://mysite.com/new-page;
    # }
}

# Second server block - Alternative server with multiple ports
server
{
    # Server network configuration
    host = 127.0.0.3;                  # Listen on localhost
    port = 9999;                       # Primary port
    port = 8081;                       # Secondary port
    port = 8082;                       # Tertiary port
    server_name = mysite.com www.mysite.com; # Server names

    # Security and limits
    client_max_body_size = 5M;         # Maximum request body size (5 MB)

    # Error page configuration
    error_page 404 www/errp/404.html;  # Custom 404 error page
    error_page 405 www/errp/405.html;
    error_page 500 www/errp/500.html;
    error_page 501 www/errp/501.html;
    # Root route - serves main website content
    route /
    {
        methods = POST GET;             # Allowed HTTP methods
        root = ./www;
        indexFile = index.html; 
        upload_path = ./session;        # Document root directory (fixed from pointing to index.html)
        autoindex = on;        # Disable directory browsing for security
        cgi = .py /usr/bin/python3
        cgi = .php php-cgi
        cgi = .perl perl5.34.0
        cgi = .sh bash
    }

    # Uploads route - for file uploads and downloads
    route /uploads
    {
        methods = POST GET DELETE;      # Allow file operations
        root = ./uploads;    
        upload_path = ./uploads;       # Document root directory (fixed from pointing to index.html)
        # indexFile = index.html;            # Upload directory
        autoindex = on;         # Allow browsing uploaded files
    }

    # Videos route - for serving video content
    route /www
    {
        methods = GET;                  # Only GET method allowed (read-only)
        root = ./www;    
        upload_path = ./session;        # Document root directory (fixed from pointing to index.html)# Videos directory (changed from /var/www/videos)
        autoindex = on;         # Allow browsing video directory
    }

    # Redirect route - demonstrates URL redirection
    route /old-page
    {
        methods = GET POST DELETE;      # Methods allowed before redirect
        redirect = https://youtube.com; # Redirect destination
        root = ./www;                   # Root directory (backup, not used for redirects)
    }

    route /cgi-bin
    {
        methods =  GET;
        root = ./cgi-bin;./
        cgi = .py /usr/bin/python3
        cgi = .php php-cgi
        cgi = .perl perl5.34.0
        cgi = .sh bash
        upload_path = ./uploads;        # Document root directory (fixed from pointing to index.html)

    }

}